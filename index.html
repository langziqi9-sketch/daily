<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ°æ° Â· æ¯æ—¥ä½æ¶ˆè€—è®°å½•</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC";
    background: #f2f6fb;
    color: #1f2d3d;
    padding: 14px;
  }

  h1 {
    font-size: 18px;
    color: #2f6fe4;
    margin-bottom: 4px;
  }

  .date {
    font-size: 14px;
    color: #6b8fd6;
    margin-bottom: 14px;
  }

  .container {
    display: flex;
    gap: 12px;
  }

  .column {
    flex: 1;
    background: #fff;
    border-radius: 14px;
    padding: 12px;
    box-shadow: 0 2px 6px rgba(47, 111, 228, 0.06);
  }

  .column h2 {
    font-size: 15px;
    color: #2f6fe4;
    margin-bottom: 10px;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
    gap: 10px;
  }

  input[type="checkbox"] {
    margin-right: 8px;
    transform: scale(1.2);
  }

  input[type="text"] {
    flex: 1;
    border: none;
    border-bottom: 1px solid #d6e2f5;
    font-size: 14px;
    padding: 8px 6px;
    background: rgba(47,111,228,0.02);
    border-radius: 6px;
  }

  input[type="text"]:focus {
    outline: none;
    border-bottom-color: #2f6fe4;
  }

  .note {
    margin-top: 14px;
    background: #fff;
    padding: 12px;
    border-radius: 14px;
    box-shadow: 0 2px 6px rgba(47, 111, 228, 0.06);
  }

  textarea {
    width: 100%;
    border: 1px solid #d6e2f5;
    border-radius: 10px;
    padding: 8px;
    font-size: 14px;
    resize: none;
  }

  textarea:focus {
    outline: none;
    border-color: #2f6fe4;
  }

  .hint {
    font-size: 12px;
    color: #8aa4d8;
    margin-top: 4px;
  }

  /* Unified controls style */
  input[type="date"], select, button {
    font-size: 14px;
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid #d6e2f5;
    background: #fff;
    color: #1f2d3d;
    box-shadow: none;
    transition: all .12s ease;
  }

  input[type="date"] {
    border-radius: 8px;
    padding: 6px 8px;
  }

  select {
    min-width: 160px;
  }

  button {
    cursor: pointer;
    background: #2f6fe4;
    color: #fff;
    border: 1px solid rgba(47,111,228,0.12);
  }

  button:hover {
    filter: brightness(.96);
  }

  /* Header controls layout */
  .date + input[type="date"] { margin-left: 6px; }
  #savedDates { margin-left: 8px; }
</style>
</head>

<body>
  <h1>ğŸŒ± æ°æ° Â· æ¯æ—¥ä½æ¶ˆè€—è®°å½•</h1>
  <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
    <div class="date" id="today"></div>
    <input type="date" id="datePicker" />
    <button id="prevDay">â—€ ä¸Šä¸€æ—¥</button>
    <button id="nextDay">ä¸‹ä¸€æ—¥ â–¶</button>
    <select id="savedDates" title="å·²ä¿å­˜çš„æ—¥æœŸ"></select>
  </div>

  <div class="container">
    <!-- æ—©ä¸Š -->
    <div class="column">
      <h2>â˜€ï¸ æ—©ä¸Šï½œæˆ‘æƒ³åšçš„äº‹</h2>
      <ul id="morningList"></ul>
      <div class="hint">è¿™æ˜¯æ„å›¾ï¼Œä¸æ˜¯æ‰¿è¯º</div>
    </div>

    <!-- æ™šä¸Š -->
    <div class="column">
      <h2>ğŸŒ™ æ™šä¸Šï½œæˆ‘å®é™…å®Œæˆäº†</h2>
      <ul id="eveningList"></ul>
      <div class="hint">å®Œæˆçš„æ‰å‹¾ï¼Œä¸åšè¯„ä»·</div>
    </div>
  </div>

  <div class="note">
    <h2>ğŸ§  ä»Šæ—¥èƒ½é‡ / çŠ¶æ€å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</h2>
    <textarea id="note" rows="2" placeholder="ä¾‹å¦‚ï¼šåç´¯ / æƒ…ç»ªèµ·ä¼"></textarea>
  </div>

<script>
  // Utility
  function formatDate(d) {
    return d.toISOString().slice(0,10);
  }

  // Elements
  const todayEl = document.getElementById("today");
  const datePicker = document.getElementById("datePicker");
  const prevDayBtn = document.getElementById("prevDay");
  const nextDayBtn = document.getElementById("nextDay");
  const savedDatesSelect = document.getElementById("savedDates");

  const morningList = document.getElementById("morningList");
  const eveningList = document.getElementById("eveningList");
  const note = document.getElementById("note");

  const defaultTasks = ["", "", "", ""];

  let currentDate = new Date();
  let data = null; // will hold loaded data for currentDate

  function keyForDate(dateStr) {
    return 'daily-' + dateStr;
  }

  function renderHeader(dateObj) {
    todayEl.innerText = dateObj.toLocaleDateString('zh-CN', { year:'numeric', month:'long', day:'numeric', weekday:'long' });
    datePicker.value = formatDate(dateObj);
  }

  function save() {
    const k = keyForDate(formatDate(currentDate));
    localStorage.setItem(k, JSON.stringify(data));
    refreshSavedDates();
  }

  function loadDataFor(dateObj) {
    currentDate = new Date(dateObj);
    const k = keyForDate(formatDate(currentDate));
    const raw = localStorage.getItem(k);
    data = raw ? JSON.parse(raw) : { tasks: [...defaultTasks], done: [false,false,false,false], note: '' };
    renderHeader(currentDate);
    renderLists();
  }

  function renderLists() {
    morningList.innerHTML = '';
    eveningList.innerHTML = '';
    const eveningInputs = [];

    data.tasks.forEach((text, i) => {
      const liM = document.createElement('li');
      const textInput = document.createElement('input');
      textInput.type = 'text';
      textInput.value = text;
      textInput.placeholder = 'å¾…åŠäº‹é¡¹';
      textInput.oninput = e => {
        data.tasks[i] = e.target.value;
        save();
        eveningInputs[i].value = e.target.value;
      };
      liM.appendChild(textInput);
      morningList.appendChild(liM);

      const liE = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = !!data.done[i];
      checkbox.onchange = e => {
        data.done[i] = e.target.checked;
        save();
      };
      const eveningText = document.createElement('input');
      eveningText.type = 'text';
      eveningText.value = text;
      eveningText.disabled = true;

      eveningInputs.push(eveningText);

      liE.appendChild(checkbox);
      liE.appendChild(eveningText);
      eveningList.appendChild(liE);
    });

    note.value = data.note || '';
    note.oninput = e => {
      data.note = e.target.value;
      save();
    };
  }

  function addDays(dateObj, delta) {
    const d = new Date(dateObj);
    d.setDate(d.getDate() + delta);
    return d;
  }

  prevDayBtn.onclick = () => {
    const d = addDays(currentDate, -1);
    loadDataFor(d);
  };
  nextDayBtn.onclick = () => {
    const d = addDays(currentDate, 1);
    loadDataFor(d);
  };

  datePicker.onchange = e => {
    const d = new Date(e.target.value + 'T00:00:00');
    loadDataFor(d);
  };

  function refreshSavedDates() {
    const keys = Object.keys(localStorage).filter(k => k.startsWith('daily-')).sort().reverse();
    savedDatesSelect.innerHTML = '';
    keys.forEach(k => {
      const dateStr = k.slice(6);
      const opt = document.createElement('option');
      opt.value = dateStr;
      opt.innerText = dateStr;
      savedDatesSelect.appendChild(opt);
    });
    // add placeholder when empty
    if (keys.length === 0) {
      const opt = document.createElement('option');
      opt.innerText = '(æ— å·²ä¿å­˜æ—¥æœŸ)';
      opt.value = '';
      savedDatesSelect.appendChild(opt);
    }
  }

  savedDatesSelect.onchange = e => {
    if (!e.target.value) return;
    const d = new Date(e.target.value + 'T00:00:00');
    loadDataFor(d);
  };

  // init
  loadDataFor(currentDate);
  refreshSavedDates();
</script>
</body>
</html>
