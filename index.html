<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ°æ° Â· æ¯æ—¥ä½æ¶ˆè€—è®°å½•</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC";
    background: #f2f6fb;
    color: #1f2d3d;
    padding: 14px;
  }

  h1 {
    font-size: 18px;
    color: #2f6fe4;
    margin-bottom: 4px;
  }

  .date {
    font-size: 14px;
    color: #6b8fd6;
    margin-bottom: 14px;
  }

  .container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .column {
    flex: 1;
    background: #fff;
    border-radius: 14px;
    padding: 12px;
    box-shadow: 0 2px 6px rgba(47, 111, 228, 0.06);
  }

  .column h2 {
    font-size: 15px;
    color: #2f6fe4;
    margin-bottom: 10px;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
    gap: 10px;
  }

  input[type="checkbox"] {
    margin-right: 8px;
    transform: scale(1.2);
  }

  input[type="text"] {
    flex: 1;
    border: none;
    border-bottom: 1px solid #d6e2f5;
    font-size: 14px;
    padding: 8px 6px;
    background: rgba(47,111,228,0.02);
    border-radius: 6px;
  }

  input[type="text"]:focus {
    outline: none;
    border-bottom-color: #2f6fe4;
  }

  .note {
    margin-top: 14px;
    background: #fff;
    padding: 12px;
    border-radius: 14px;
    box-shadow: 0 2px 6px rgba(47, 111, 228, 0.06);
  }

  textarea {
    width: 100%;
    border: 1px solid #d6e2f5;
    border-radius: 10px;
    padding: 8px;
    font-size: 14px;
    resize: none;
  }

  textarea:focus {
    outline: none;
    border-color: #2f6fe4;
  }

  .hint {
    font-size: 12px;
    color: #8aa4d8;
    margin-top: 4px;
  }

  /* Unified controls style */
  input[type="date"], input[type="time"], select, button {
    font-size: 14px;
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid #d6e2f5;
    background: #fff;
    color: #1f2d3d;
    box-shadow: none;
    transition: all .12s ease;
  }

  input[type="date"], input[type="time"] {
    border-radius: 8px;
    padding: 6px 8px;
  }

  select {
    min-width: 160px;
  }

  button {
    cursor: pointer;
    background: #2f6fe4;
    color: #fff;
    border: 1px solid rgba(47,111,228,0.12);
  }

  button:hover {
    filter: brightness(.96);
  }

  /* Header controls layout */
  .date + input[type="date"] { margin-left: 6px; }
  #savedDates { margin-left: 8px; }
</style>
</head>

<body>
  <h1>ğŸŒ± æ°æ° Â· æ¯æ—¥ä½æ¶ˆè€—è®°å½•</h1>
  <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
    <div class="date" id="today"></div>
    <input type="date" id="datePicker" />
    <button id="prevDay">â—€ ä¸Šä¸€æ—¥</button>
    <button id="nextDay">ä¸‹ä¸€æ—¥ â–¶</button>
    <select id="savedDates" title="å·²ä¿å­˜çš„æ—¥æœŸ"></select>
  </div>

  <div class="container">
    <!-- ä½œæ¯ -->
    <div class="column">
      <h2>ğŸ›ï¸ ä½œæ¯ï½œæ¯æ—¥æ—¶åˆ»</h2>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div>
          <label style="font-size:12px;color:#8aa4d8;display:block;margin-bottom:4px;">ğŸŒ… é†’æ¥</label>
          <input type="time" id="wakeTime" />
        </div>
        <div>
          <label style="font-size:12px;color:#8aa4d8;display:block;margin-bottom:4px;">ğŸš¶ èµ·åºŠ</label>
          <input type="time" id="getUpTime" />
        </div>
        <div>
          <label style="font-size:12px;color:#8aa4d8;display:block;margin-bottom:4px;">ğŸ˜´ å…¥ç¡</label>
          <input type="time" id="sleepTime" />
        </div>
      </div>
      <div class="hint">è®°å½•ä½œæ¯è§„å¾‹</div>
    </div>

    <!-- æ—©ä¸Š -->
    <div class="column">
      <h2>â˜€ï¸ æ—©ä¸Šï½œæˆ‘æƒ³åšçš„äº‹</h2>
      <ul id="morningList"></ul>
      <button id="addTaskBtn" style="width:100%;margin-top:8px;">+ æ·»åŠ å¾…åŠ</button>
      <div class="hint">è¿™æ˜¯æ„å›¾ï¼Œä¸æ˜¯æ‰¿è¯º</div>
    </div>

    <!-- å®Œæˆæƒ…å†µ -->
    <div class="column">
      <h2>ğŸŒ™ æ™šä¸Šï½œå®Œæˆæƒ…å†µ</h2>
      <ul id="eveningList"></ul>
      <div class="hint">å®Œæˆçš„æ‰å‹¾ï¼Œä¸åšè¯„ä»·</div>
    </div>

    <!-- æˆ‘åšçš„äº‹ -->
    <div class="column">
      <h2>âœ… é¢å¤–ï½œæˆ‘åšäº†çš„äº‹</h2>
      <ul id="doneList"></ul>
      <button id="addDoneBtn" style="width:100%;margin-top:8px;">+ æ·»åŠ äº‹é¡¹</button>
      <div class="hint">è®°å½•æ„å¤–ä¹‹å–œ</div>
    </div>
  </div>

  <div class="note">
    <h2>ğŸ§  ä»Šæ—¥èƒ½é‡ / çŠ¶æ€å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</h2>
    <textarea id="note" rows="2" placeholder="ä¾‹å¦‚ï¼šåç´¯ / æƒ…ç»ªèµ·ä¼"></textarea>
  </div>

<script>
  // Utility - ç»Ÿä¸€ä½¿ç”¨æœ¬åœ°æ—¥æœŸï¼Œé¿å…æ—¶åŒºé—®é¢˜
  function getLocalDateString(dateObj) {
    const year = dateObj.getFullYear();
    const month = String(dateObj.getMonth() + 1).padStart(2, '0');
    const day = String(dateObj.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  function formatDate(dateObj) {
    return getLocalDateString(dateObj);
  }

  // Elements
  const todayEl = document.getElementById("today");
  const datePicker = document.getElementById("datePicker");
  const prevDayBtn = document.getElementById("prevDay");
  const nextDayBtn = document.getElementById("nextDay");
  const savedDatesSelect = document.getElementById("savedDates");

  const wakeTimeInput = document.getElementById("wakeTime");
  const getUpTimeInput = document.getElementById("getUpTime");
  const sleepTimeInput = document.getElementById("sleepTime");

  const morningList = document.getElementById("morningList");
  const eveningList = document.getElementById("eveningList");
  const doneList = document.getElementById("doneList");
  const addTaskBtn = document.getElementById("addTaskBtn");
  const addDoneBtn = document.getElementById("addDoneBtn");
  const note = document.getElementById("note");

  let currentDate = new Date();
  let data = null; // will hold loaded data for currentDate

  function keyForDate(dateStr) {
    return 'daily-' + dateStr;
  }

  function renderHeader(dateObj) {
    const displayDate = new Date(dateObj);
    todayEl.innerText = displayDate.toLocaleDateString('zh-CN', { year:'numeric', month:'long', day:'numeric', weekday:'long' });
    const dateStr = formatDate(displayDate);
    datePicker.value = dateStr;
  }

  function save() {
    const k = keyForDate(formatDate(currentDate));
    localStorage.setItem(k, JSON.stringify(data));
    refreshSavedDates();
  }

  function loadDataFor(dateObj) {
    currentDate = new Date(dateObj);
    currentDate.setHours(0, 0, 0, 0); // é‡ç½®ä¸ºåˆå¤œï¼Œé¿å…æ—¶é—´éƒ¨åˆ†å¹²æ‰°
    const k = keyForDate(formatDate(currentDate));
    const raw = localStorage.getItem(k);
    
    if (raw) {
      data = JSON.parse(raw);
    } else {
      data = { 
        wake: '',
        getUp: '',
        sleep: '',
        tasks: [], 
        done: [], 
        extraDone: [],
        note: '' 
      };
    }
    
    renderHeader(currentDate);
    renderLists();
  }

  function renderLists() {
    // åŠ è½½ä½œæ¯æ—¶é—´
    wakeTimeInput.value = data.wake || '';
    getUpTimeInput.value = data.getUp || '';
    sleepTimeInput.value = data.sleep || '';

    // ç»‘å®šä½œæ¯æ—¶é—´äº‹ä»¶
    wakeTimeInput.oninput = e => {
      data.wake = e.target.value;
      save();
    };
    getUpTimeInput.oninput = e => {
      data.getUp = e.target.value;
      save();
    };
    sleepTimeInput.oninput = e => {
      data.sleep = e.target.value;
      save();
    };

    morningList.innerHTML = '';
    eveningList.innerHTML = '';
    doneList.innerHTML = '';

    // ç¡®ä¿ done æ•°ç»„é•¿åº¦ä¸ tasks ä¸€è‡´
    while (data.done.length < data.tasks.length) {
      data.done.push(false);
    }
    data.done = data.done.slice(0, data.tasks.length);

    // æ¸²æŸ“æ—©ä¸Šä»»åŠ¡ã€æ™šä¸Šå®Œæˆæƒ…å†µ
    data.tasks.forEach((text, i) => {
      // æ—©ä¸Šè¾“å…¥æ¡†
      const liM = document.createElement('li');
      const textInput = document.createElement('input');
      textInput.type = 'text';
      textInput.value = text;
      textInput.placeholder = 'å¾…åŠäº‹é¡¹';
      
      const deleteBtn = document.createElement('button');
      deleteBtn.innerText = 'âœ•';
      deleteBtn.style.padding = '4px 8px';
      deleteBtn.style.marginLeft = '4px';
      deleteBtn.style.minWidth = '32px';
      deleteBtn.onclick = () => {
        data.tasks.splice(i, 1);
        data.done.splice(i, 1);
        save();
        renderLists();
      };
      
      textInput.oninput = e => {
        data.tasks[i] = e.target.value;
        save();
      };
      
      liM.appendChild(textInput);
      liM.appendChild(deleteBtn);
      morningList.appendChild(liM);

      // æ™šä¸Šå‹¾é€‰æ¡†
      const liE = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = !!data.done[i];
      checkbox.onchange = e => {
        data.done[i] = e.target.checked;
        save();
      };
      const eveningText = document.createElement('input');
      eveningText.type = 'text';
      eveningText.value = text;
      eveningText.disabled = true;

      liE.appendChild(checkbox);
      liE.appendChild(eveningText);
      eveningList.appendChild(liE);
    });

    // æ¸²æŸ“"æˆ‘åšäº†çš„äº‹"åˆ—è¡¨
    if (!data.extraDone) {
      data.extraDone = [];
    }
    
    data.extraDone.forEach((text, idx) => {
      const li = document.createElement('li');
      const textInput = document.createElement('input');
      textInput.type = 'text';
      textInput.value = text;
      textInput.placeholder = 'é¢å¤–å®Œæˆçš„äº‹';
      
      const deleteBtn = document.createElement('button');
      deleteBtn.innerText = 'âœ•';
      deleteBtn.style.padding = '4px 8px';
      deleteBtn.style.marginLeft = '4px';
      deleteBtn.style.minWidth = '32px';
      deleteBtn.onclick = () => {
        data.extraDone.splice(idx, 1);
        save();
        renderLists();
      };
      
      textInput.oninput = e => {
        data.extraDone[idx] = e.target.value;
        save();
      };
      
      li.appendChild(textInput);
      li.appendChild(deleteBtn);
      doneList.appendChild(li);
    });

    note.value = data.note || '';
    note.oninput = e => {
      data.note = e.target.value;
      save();
    };
  }

  function addDays(dateObj, delta) {
    const d = new Date(dateObj);
    d.setDate(d.getDate() + delta);
    return d;
  }

  // æ·»åŠ å¾…åŠäº‹é¡¹
  addTaskBtn.onclick = () => {
    data.tasks.push('');
    data.done.push(false);
    save();
    renderLists();
  };

  // æ·»åŠ "æˆ‘åšäº†çš„äº‹"
  addDoneBtn.onclick = () => {
    if (!data.extraDone) data.extraDone = [];
    data.extraDone.push('');
    save();
    renderLists();
  };

  prevDayBtn.onclick = () => {
    const d = addDays(currentDate, -1);
    loadDataFor(d);
  };
  nextDayBtn.onclick = () => {
    const d = addDays(currentDate, 1);
    loadDataFor(d);
  };

  datePicker.onchange = e => {
    // ä½¿ç”¨æœ¬åœ°æ—¥æœŸè§£æï¼Œé¿å…æ—¶åŒºé—®é¢˜
    const dateStr = e.target.value; // YYYY-MM-DD
    const [year, month, day] = dateStr.split('-').map(Number);
    const d = new Date(year, month - 1, day);
    loadDataFor(d);
  };

  function refreshSavedDates() {
    const keys = Object.keys(localStorage).filter(k => k.startsWith('daily-')).sort().reverse();
    savedDatesSelect.innerHTML = '';
    const currentDateStr = formatDate(currentDate);
    
    keys.forEach(k => {
      const dateStr = k.slice(6);
      const opt = document.createElement('option');
      opt.value = dateStr;
      opt.innerText = dateStr;
      if (dateStr === currentDateStr) {
        opt.selected = true;
      }
      savedDatesSelect.appendChild(opt);
    });
    
    if (keys.length === 0) {
      const opt = document.createElement('option');
      opt.innerText = '(æ— å·²ä¿å­˜æ—¥æœŸ)';
      opt.value = '';
      savedDatesSelect.appendChild(opt);
    }
  }

  savedDatesSelect.onchange = e => {
    if (!e.target.value) return;
    // ä½¿ç”¨æœ¬åœ°æ—¥æœŸè§£æ
    const dateStr = e.target.value; // YYYY-MM-DD
    const [year, month, day] = dateStr.split('-').map(Number);
    const d = new Date(year, month - 1, day);
    loadDataFor(d);
  };

  // init
  currentDate = new Date();
  currentDate.setHours(0, 0, 0, 0); // é‡ç½®ä¸ºåˆå¤œ
  loadDataFor(currentDate);
  refreshSavedDates();
</script>
</body>
</html>
